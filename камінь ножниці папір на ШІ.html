<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Камінь-Ножиці-Папір — AI</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 40px;
    }
    button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
    }
    #result {
      margin-top: 30px;
      font-size: 24px;
      font-weight: bold;
    }
    #scores {
      margin-top: 20px;
      font-size: 20px;
    }
    .win { color: green; }
    .lose { color: red; }
    .draw { color: orange; }
    .level-btn {
      background: #ddd;
      border-radius: 8px;
    }
    .selected {
      background: #4caf50;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>Камінь-Ножиці-Папір</h1>
  <p>Спробуй мене перемогти за 100 ходів!</p>

  <div>
    <button onclick="play('камінь')">Камінь</button>
    <button onclick="play('ножиці')">Ножиці</button>
    <button onclick="play('папір')">Папір</button>
  </div>

  <h3>Рівень складності:</h3>
  <div>
    <button class="level-btn selected" onclick="setLevel(0)">0 - Рандом</button>
    <button class="level-btn" onclick="setLevel(1)">1 - Частотний аналіз</button>
    <button class="level-btn" onclick="setLevel(2)">2 - Ланцюг Маркова (1-й рівень)</button>
    <button class="level-btn" onclick="setLevel(3)">3 - Ланцюг Маркова (2-й рівень)</button>
  </div>

  <div id="result"></div>

  <div id="scores">
    <p>Очки гравця: <span id="playerScore">0</span></p>
    <p>Очки комп'ютера: <span id="computerScore">0</span></p>
  </div>

  <script>
    const choices = ['камінь', 'ножиці', 'папір'];
    let playerScore = 0;
    let computerScore = 0;
    let difficulty = 0;

    let moveCounts = { 'камінь': 0, 'ножиці': 0, 'папір': 0 };
    let firstLevel = {
      'камінь': { 'камінь': 0, 'ножиці': 0, 'папір': 0 },
      'ножиці': { 'камінь': 0, 'ножиці': 0, 'папір': 0 },
      'папір': { 'камінь': 0, 'ножиці': 0, 'папір': 0 }
    };
    let secondLevel = {};
    let prevMove = null;
    let prevPrevMove = null;

    function setLevel(lvl) {
      difficulty = lvl;
      document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('selected'));
      document.querySelectorAll('.level-btn')[lvl].classList.add('selected');
    }

    function updateScores() {
      document.getElementById('playerScore').textContent = playerScore;
      document.getElementById('computerScore').textContent = computerScore;
    }

    function play(playerChoice) {
      decayWeights();
      const computerChoice = getComputerChoice();
      let result = '', resultClass = '';

      if (playerChoice === computerChoice) {
        result = 'Нічия!';
        playerScore += 0.5;
        computerScore += 0.5;
        resultClass = 'draw';
      } else if (
        (playerChoice === 'камінь' && computerChoice === 'ножиці') ||
        (playerChoice === 'ножиці' && computerChoice === 'папір') ||
        (playerChoice === 'папір' && computerChoice === 'камінь')
      ) {
        result = 'Ти переміг!';
        playerScore += 1;
        resultClass = 'win';
      } else {
        result = "Комп'ютер переміг!";
        computerScore += 1;
        resultClass = 'lose';
      }

      document.getElementById('result').innerHTML = `
        Ти вибрав: <b>${playerChoice}</b><br>
        Комп'ютер вибрав: <b>${computerChoice}</b><br>
        <span class="${resultClass}">${result}</span>
      `;

      recordMove(playerChoice);
      updateScores();
    }

    function getComputerChoice() {
      if (difficulty === 0) {
        return choices[Math.floor(Math.random() * 3)];
      }

      if (difficulty === 1) {
        let maxMove = getMaxKey(moveCounts);
        if (Math.random() < 0.5) {
          return counterMove(maxMove);
        } else {
          return choices[Math.floor(Math.random() * 3)];
        }
      }

      if (difficulty === 2 && prevMove) {
        let predMove = getMaxKey(firstLevel[prevMove]);
        return counterMove(predMove);
      }

      if (difficulty === 3 && prevMove && prevPrevMove) {
        let key = `${prevPrevMove},${prevMove}`;
        if (!secondLevel[key]) secondLevel[key] = { 'камінь': 0, 'ножиці': 0, 'папір': 0 };
        let predMove = getMaxKey(secondLevel[key]);
        return counterMove(predMove);
      }

      return choices[Math.floor(Math.random() * 3)];
    }

    function counterMove(move) {
      if (move === 'камінь') return 'папір';
      if (move === 'папір') return 'ножиці';
      if (move === 'ножиці') return 'камінь';
      return choices[Math.floor(Math.random() * 3)];
    }

    function getMaxKey(obj) {
      return Object.keys(obj).reduce((a, b) => obj[a] > obj[b] ? a : b);
    }

    function recordMove(playerMove) {
      moveCounts[playerMove]++;

      if (prevMove) {
        firstLevel[prevMove][playerMove]++;
      }

      if (prevPrevMove && prevMove) {
        let key = `${prevPrevMove},${prevMove}`;
        if (!secondLevel[key]) {
          secondLevel[key] = { 'камінь': 0, 'ножиці': 0, 'папір': 0 };
        }
        secondLevel[key][playerMove]++;
      }

      prevPrevMove = prevMove;
      prevMove = playerMove;
    }

    function decayWeights() {
      for (let move in moveCounts) moveCounts[move] *= 0.9;
      for (let prev in firstLevel)
        for (let next in firstLevel[prev])
          firstLevel[prev][next] *= 0.9;
      for (let key in secondLevel)
        for (let move in secondLevel[key])
          secondLevel[key][move] *= 0.9;
    }
  </script>
</body>
</html>
